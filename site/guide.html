<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>使用说明 · KidneySphere AI（科研优先）</title>
  <link rel="stylesheet" href="/app.css"/>
  <link rel="stylesheet" href="/guide.css"/>
  <link rel="stylesheet" href="/guide-steps.css"/>
  <link rel="icon" href="/assets/kidneysphere-ai.png"/>
</head>
<body>
  <div class="container guide">
    <div class="card">
      <div class="brand">
        <img src="/assets/kidneysphere-ai.png" alt="肾域AI KidneySphere AI"/>
        <div>
          <h1 class="brand-title">使用说明（试用必读 · 面向所有人）</h1>
          <div class="brand-sub">世界级极简 · 科研小白 10 分钟闭环 · 多中心合并 · IgAN MEST‑C · 基因变异长表</div>
        </div>
      </div>

      <div class="warnbox" style="margin-top:12px">
        <b>科研用途优先：</b>本系统仅用于随访数据登记与研究汇总，不提供诊断/处方/急救指导；
        <b>请勿</b>录入姓名/电话/病案号/身份证等可识别个人信息（PII）。
      </div>

      <div class="guide-hero" style="margin-top:12px">
        <div class="guide-hero-title">🎯 10 分钟拿到论文核心材料（科研小白也能跑通）</div>
        <div class="guide-hero-sub">
          最短路径：<b>后台导出论文包 zip → 本地一键运行 → 自动生成 Table 1 / QC / 趋势图 / 12m 结局 / Methods 草稿</b>。
          多中心合并键为 <code>center_code + patient_code</code>。
        </div>
        <div class="guide-hero-actions">
          <a class="linkbtn primary" href="/staff" target="_blank">打开后台 /staff</a>
          <a class="linkbtn" href="#trial">试用必读</a>
          <a class="linkbtn" href="#roles">选择我的角色</a>
        </div>
        <div class="muted small" style="margin-top:10px">
          提示：系统导出 CSV 默认带 UTF‑8 BOM，Excel 直接打开一般不乱码；若出现 <code>######</code> 多为列宽不足（双击列边界自动适配）。
        </div>
      </div>

      <div class="hr"></div>

      <h2 id="trial">试用必读（所有人必须看）</h2>
      <div class="trial-grid">
        <div class="trial-card">
          <div class="trial-title">试用目的</div>
          <div class="small">
            在 3–10 个中心联动场景下，用最少操作跑通科研闭环：<br/>
            <b>录入 → 导出论文包 → 一键统计 → QC → 补录 → 再导出 → 固化版本</b>。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">试用周期（默认建议）</div>
          <div class="small">
            <b>8 周试用</b>（可录入/修改/导出） + <b>2 周宽限</b>（仅用于导出最终论文包与复核，原则上不再新增/修改）。<br/>
            以后台显示的到期日为准。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">到期后会怎样？</div>
          <div class="small">
            到期后项目进入 <b>只读</b>（保证多中心结果可复现，避免“边分析边改数据”）。<br/>
            宽限期内仍可导出最终论文包用于 DCC 合并与复核。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">合规与去标识化</div>
          <div class="small">
            <b>禁止录入 PII</b>（姓名/电话/MRN/身份证等）。<br/>
            patient_code 只能是研究编号；各中心本地保存映射表，不上传系统。
          </div>
        </div>
      </div>

      <div class="okbox" style="margin-top:10px">
        <b>试用成功验收（建议）</b><br/>
        1) 能稳定生成论文包并跑出输出；2) 至少完成 1 轮 QC→补录→复跑；3) 核心四项（日期/BP/Scr/UPCR）完整率明显提升；4) 多中心合并无冲突；5) 同一导出包重复运行结果一致。
      </div>

      <div class="hr"></div>

      <h2 id="roles">你属于哪类角色？（点一下只看你需要的）</h2>
      <div class="rolebar">
        <button class="rolebtn active" data-role="all" type="button">全部内容</button>
        <button class="rolebtn" data-role="entry" type="button">我是录入者（护士/医生/随访）</button>
        <button class="rolebtn" data-role="stats" type="button">我是统计者（研究生/DCC）</button>
        <button class="rolebtn" data-role="pi" type="button">我是 PI/管理员</button>
      </div>

      <section class="role-section" data-role="entry all">
        <div class="hr"></div>
        <h2>录入者：3 分钟上手</h2>
        <div class="guide-grid2">
          <div class="callout">
            <div class="callout-title">你只需要记住两句话</div>
            <ol class="compact">
              <li>每次随访至少录 4 项：<b>日期 / BP / Scr / UPCR</b></li>
              <li><b>不要录入 PII</b>，只用研究编号 <code>patient_code</code></li>
            </ol>
          </div>
          <div class="callout">
            <div class="callout-title">最短步骤</div>
            <ol class="compact">
              <li>打开中心给你的随访链接（token）</li>
              <li>填：日期、血压、Scr、UPCR</li>
              <li>确认无误后提交</li>
            </ol>
          </div>
        </div>

        <details class="faq" style="margin-top:10px">
          <summary>录入常见坑（看一眼就避雷）</summary>
          <ul class="compact small">
            <li>Excel 显示 <code>######</code>：列宽不足，不是坏数据</li>
            <li>Scr/UPCR 数值怪：优先怀疑单位/小数点</li>
            <li>同一天多条随访：尽量避免，会影响趋势/结局计算</li>
          </ul>
        </details>
      </section>

      <section class="role-section" data-role="stats all" id="research">
        <div class="hr"></div>
        <h2>统计者：科研统计 & 论文 Starter Kit（交互教程）</h2>
        <div class="muted">
          目标：让科研小白“点一下按钮就能写论文”。按步骤推进：<b>生成论文包 → 本地运行 → 看 QC → 补数据 → 复现输出</b>。
        </div>

        <div class="stepper" id="stepper">
          <div class="step-nav" role="navigation" aria-label="科研教程步骤">
            <div class="step-nav-title">步骤导航</div>
            <button class="step-item" data-step="0" type="button"><span class="step-idx">0</span> 准备环境</button>
            <button class="step-item" data-step="1" type="button"><span class="step-idx">1</span> 生成论文包</button>
            <button class="step-item" data-step="2" type="button"><span class="step-idx">2</span> 解压与目录核对</button>
            <button class="step-item" data-step="3" type="button"><span class="step-idx">3</span> 安装依赖</button>
            <button class="step-item" data-step="4" type="button"><span class="step-idx">4</span> 一键运行</button>
            <button class="step-item" data-step="5" type="button"><span class="step-idx">5</span> 看 QC 并补数据</button>
            <button class="step-item" data-step="6" type="button"><span class="step-idx">6</span> 放进论文</button>

            <div class="hr" style="margin:12px 0"></div>
            <a class="step-link" href="#faq">常见问题（FAQ）</a>
          </div>

          <div class="step-content">
            <section class="step-panel" data-step-panel="0">
              <div class="step-title">Step 0 · 准备环境（只做一次）</div>
              <p class="small">你只需要一台电脑 + Python 3.10+。科研小白推荐安装 <b>Anaconda</b>。</p>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>检查 Python 是否可用</b></div>
                  <button class="copybtn" type="button" data-copy="python --version&#10;pip --version">复制</button>
                </div>
                <pre><code>python --version
pip --version</code></pre>
              </div>
              <details class="faq">
                <summary>如果提示“python 不是内部命令”，怎么办？</summary>
                <ul class="compact small">
                  <li><b>Windows：</b>重新安装 Python（勾选 Add Python to PATH）或安装 Anaconda。</li>
                  <li><b>Mac：</b>建议安装 python.org 或 Homebrew 版本。</li>
                </ul>
              </details>
              <label class="donecheck"><input type="checkbox" data-done-step="0"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="1">
              <div class="step-title">Step 1 · 在后台一键生成论文包（zip）</div>
              <p class="small">
                后台 <code>/staff</code> 打开项目后点击：<b>「一键生成论文包（zip）」</b>。
                系统会打包：去标识化 CSV 长表 + Starter Kit（脚本与模板）。
              </p>
              <label class="donecheck"><input type="checkbox" data-done-step="1"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="2">
              <div class="step-title">Step 2 · 解压与目录核对</div>
              <p class="small">解压 zip 后，确认包含 <code>analysis/data/</code> 与 <code>analysis/run_analysis.py</code>。</p>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>目录应类似这样</b></div>
                  <button class="copybtn" type="button" data-copy="paper_pack_xxx/&#10;  analysis/&#10;    data/&#10;      patients_baseline.csv&#10;      visits_long.csv&#10;      labs_long.csv&#10;      meds_long.csv&#10;      variants_long.csv&#10;    run_analysis.py&#10;    outputs/&#10;  manuscript/&#10;    METHODS_AUTO_EN.md">复制</button>
                </div>
                <pre><code>paper_pack_xxx/
  analysis/
    data/
      patients_baseline.csv
      visits_long.csv
      labs_long.csv
      meds_long.csv
      variants_long.csv
    run_analysis.py
    outputs/
  manuscript/
    METHODS_AUTO_EN.md</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="2"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="3">
              <div class="step-title">Step 3 · 安装依赖（第一次才需要）</div>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>安装依赖</b></div>
                  <button class="copybtn" type="button" data-copy="pip install -r analysis/requirements.txt">复制</button>
                </div>
                <pre><code>pip install -r analysis/requirements.txt</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="3"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="4">
              <div class="step-title">Step 4 · 一键运行（生成 Table1/QC/图/12m结局/Methods）</div>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>运行脚本</b></div>
                  <button class="copybtn" type="button" data-copy="python analysis/run_analysis.py">复制</button>
                </div>
                <pre><code>python analysis/run_analysis.py</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="4"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="5">
              <div class="step-title">Step 5 · 先看 QC，再补数据，再跑一遍</div>
              <p class="small">
                顶刊级研究最重要的是：数据干净、口径统一、可复现。请优先打开 <code>analysis/outputs/qc_report.xlsx</code>。
              </p>
              <label class="donecheck"><input type="checkbox" data-done-step="5"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="6">
              <div class="step-title">Step 6 · 把输出放进论文</div>
              <table class="table">
                <thead><tr><th>输出</th><th>用于论文</th><th>备注</th></tr></thead>
                <tbody>
                  <tr><td><code>table1_baseline.xlsx</code></td><td>Table 1</td><td>基线特征表</td></tr>
                  <tr><td><code>qc_report.xlsx</code></td><td>质量控制</td><td>缺失/异常/重复/中心汇总</td></tr>
                  <tr><td><code>plot_*.png</code></td><td>Figure</td><td>趋势图</td></tr>
                  <tr><td><code>outcomes_12m.csv</code></td><td>Results</td><td>12 个月结局</td></tr>
                  <tr><td><code>METHODS_AUTO_EN.md</code></td><td>Methods 草稿</td><td>PI 最终审阅</td></tr>
                </tbody>
              </table>
              <label class="donecheck"><input type="checkbox" data-done-step="6"> 我已完成此步</label>
            </section>
          </div>
        </div>
      </section>

      <section class="role-section" data-role="pi all">
        <div class="hr"></div>
        <h2>PI/管理员：多中心治理要点（务实）</h2>
        <div class="kv">
          <div>合并键</div><div><b>center_code + patient_code</b>（必须全局唯一）</div>
          <div>去标识化</div><div>系统不存身份信息；各中心本地受控保存映射表</div>
          <div>口径统一</div><div>最少四项（日期/BP/Scr/UPCR）+ 单位一致性</div>
          <div>试用到期</div><div>到期后只读，避免边分析边改数据，保证可复现</div>
          <div>IgAN 病理</div><div>支持 Oxford <b>MEST‑C</b>（常用于分层/预测/敏感性分析）</div>
          <div>基因</div><div>支持 variants_long（如有：ACMG、zygosity、HGVS 等）</div>
        </div>
      </section>

      <div class="hr"></div>

      <h2 id="faq">常见问题（FAQ）</h2>
      <div class="faq-tools">
        <input id="faqSearch" placeholder="搜索：乱码 / ###### / ModuleNotFoundError / token / MEST / 基因 …"/>
        <button class="btn small" id="faqOpenAll" type="button">全部展开</button>
        <button class="btn small" id="faqCloseAll" type="button">全部收起</button>
      </div>

      <details class="faq" open data-faq>
        <summary>Excel 打开 CSV 显示乱码怎么办？</summary>
        <div class="small">
          建议使用 Excel「数据 → 从文本/CSV」导入并选择编码 UTF‑8。系统导出的 CSV 已带 UTF‑8 BOM，直接打开通常不会乱码。
        </div>
      </details>

      <details class="faq" data-faq>
        <summary>Excel 里日期显示 ###### 是数据坏了吗？</summary>
        <div class="small">不是。通常是列宽不足。双击列边界自动适配即可显示日期。</div>
      </details>

      <details class="faq" data-faq>
        <summary>脚本运行报错：ModuleNotFoundError</summary>
        <div class="small">说明依赖没装好。执行：<code>pip install -r analysis/requirements.txt</code>。</div>
      </details>

      <details class="faq" data-faq>
        <summary>同一患者同一天多条随访怎么办？</summary>
        <div class="small">通常视为重复记录。建议保留一条（或合并），否则趋势/结局会受影响。</div>
      </details>

      <details class="faq" data-faq>
        <summary>为什么强调不录入 PII？</summary>
        <div class="small">为了合规与多中心协作。系统用研究编号即可完成随访与分析；身份映射表由各中心本地受控保存。</div>
      </details>

      <div class="hr"></div>

      <div class="muted small">
        最后更新：2026-02-17。可直接分享链接作为中心培训：<code>/guide#trial</code> 或 <code>/guide#research</code>。
      </div>
    </div>
  </div>

  <script type="module" src="/guide.js"></script>
</body>
</html>
