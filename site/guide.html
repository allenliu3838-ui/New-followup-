<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>使用说明 · KidneySphere AI（科研优先）</title>
  <link rel="stylesheet" href="/app.css"/>
  <link rel="stylesheet" href="/guide.css"/>
  <link rel="stylesheet" href="/guide-steps.css"/>
  <link rel="icon" href="/assets/kidneysphere-ai.png"/>
</head>
<body>
  <div class="container guide">
    <div class="card">
      <div class="brand">
        <img src="/assets/kidneysphere-ai.png" alt="肾域AI KidneySphere AI"/>
        <div>
          <h1 class="brand-title">使用说明（试用必读 · 面向所有人）</h1>
          <div class="brand-sub">世界级极简 · 科研小白 10 分钟闭环 · 多中心合并 · IgAN MEST‑C · 基因变异长表</div>
        </div>
      </div>

      <div class="warnbox" style="margin-top:12px">
        <b>科研用途优先：</b>本系统仅用于随访数据登记与研究汇总，不提供诊断/处方/急救指导；
        <b>请勿</b>录入姓名/电话/病案号/身份证等可识别个人信息（PII）。
      </div>

      <div class="guide-hero" style="margin-top:12px">
        <div class="guide-hero-title">🎯 10 分钟拿到论文核心材料（科研小白也能跑通）</div>
        <div class="guide-hero-sub">
          最短路径：<b>后台导出论文包 zip → 本地一键运行 → 自动生成 Table 1 / QC / 趋势图 / 12m 结局 / Methods 草稿</b>。
          多中心合并键为 <code>center_code + patient_code</code>。
        </div>
        <div class="guide-hero-actions">
          <a class="linkbtn primary" href="/staff" target="_blank">打开后台 /staff</a>
          <a class="linkbtn" href="#scenarios">科研场景举例</a>
          <a class="linkbtn" href="#general-module">GENERAL模块说明</a>
          <a class="linkbtn" href="#trial">试用必读</a>
          <a class="linkbtn" href="#roles">选择角色</a>
          <a class="linkbtn" href="/slides">系统介绍PPT</a>
          <a class="linkbtn" href="/demo">预约演示</a>
        </div>
        <div class="muted small" style="margin-top:10px">
          提示：系统导出 CSV 默认带 UTF‑8 BOM，Excel 直接打开一般不乱码；若出现 <code>######</code> 多为列宽不足（双击列边界自动适配）。
        </div>
      </div>

      <div class="hr"></div>

      <h2 id="trial">试用必读（所有人必须看）</h2>
      <div class="trial-grid">
        <div class="trial-card">
          <div class="trial-title">试用目的</div>
          <div class="small">
            在 3–10 个中心联动场景下，用最少操作跑通科研闭环：<br/>
            <b>录入 → 导出论文包 → 一键统计 → QC → 补录 → 再导出 → 固化版本</b>。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">试用周期（默认建议）</div>
          <div class="small">
            <b>3 个月试用（90 天）</b>（可录入/修改/导出） + <b>10 天宽限</b>（仅用于导出最终论文包与复核，原则上不再新增/修改）。<br/>
            以后台显示的到期日为准。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">到期后会怎样？</div>
          <div class="small">
            到期后项目进入 <b>只读</b>（保证多中心结果可复现，避免“边分析边改数据”）。<br/>
            宽限期内仍可导出最终论文包用于 DCC 合并与复核。
          </div>
        </div>
        <div class="trial-card">
          <div class="trial-title">合规与去标识化</div>
          <div class="small">
            <b>禁止录入 PII</b>（姓名/电话/MRN/身份证等）。<br/>
            patient_code 只能是研究编号；各中心本地保存映射表，不上传系统。
          </div>
        </div>
      </div>

      <div class="okbox" style="margin-top:10px">
        <b>试用成功验收（建议）</b><br/>
        1) 能稳定生成论文包并跑出输出；2) 至少完成 1 轮 QC→补录→复跑；3) 核心四项（日期/BP/Scr/UPCR）完整率明显提升；4) 多中心合并无冲突；5) 同一导出包重复运行结果一致。
      </div>

      <div class="hr"></div>

      <!-- ===== 科研场景举例 ===== -->
      <h2 id="scenarios">📋 这套系统能做什么科研？（场景举例）</h2>
      <div class="muted small" style="margin-bottom:10px">以下均为<b>真实常见科研需求</b>，系统可直接支持，无需额外开发。</div>

      <div class="scenario-grid">

        <div class="scenario-card">
          <div class="scenario-tag igan">IgAN</div>
          <div class="scenario-title">IgA 肾病多中心队列研究</div>
          <div class="small">
            <b>研究目的：</b>评估 Oxford MEST-C 病理积分与 5 年肾功能进展（eGFR 下降 ≥ 40%）的关联。<br/>
            <b>参与方：</b>北京/上海/广州 3 家中心，合计 280 例。<br/>
            <b>做法：</b>各中心用同一 center_code 录入基线（含 MEST-C）+ 每季度随访（BP/Scr/UPCR）；后台导出合并包 → 一键跑出 Kaplan-Meier 曲线 + Table 1 + Cox 回归 draft。<br/>
            <b>投稿方向：</b>JASN / KI / AJKD
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-tag ln">LN</div>
          <div class="scenario-title">狼疮性肾炎诱导缓解疗效比较</div>
          <div class="small">
            <b>研究目的：</b>比较他克莫司 vs. MMF 在 III/IV 型 LN 的 12 个月完全缓解率。<br/>
            <b>参与方：</b>单中心，120 例。<br/>
            <b>做法：</b>录入基线用药方案 + 每月随访 UPCR/补体/dsDNA；12 个月时后台一键生成结局表（完全缓解 = UPCR < 0.5 + Scr 稳定）。<br/>
            <b>投稿方向：</b>ARD / Rheumatology
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-tag mn">MN</div>
          <div class="scenario-title">膜性肾病 PLA2R 滴度与缓解预测</div>
          <div class="small">
            <b>研究目的：</b>分析基线 PLA2R 抗体滴度与 24 个月自发缓解率的关系。<br/>
            <b>参与方：</b>单中心，80 例。<br/>
            <b>做法：</b>基线录入 PLA2R 滴度（lab_long 表）+ 每 3 月随访 UPCR；系统自动判断缓解（UPCR < 0.5）并输出缓解时间分布。<br/>
            <b>投稿方向：</b>JASN / KI
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-tag ktx">KTX</div>
          <div class="scenario-title">肾移植术后排斥反应监测</div>
          <div class="small">
            <b>研究目的：</b>描述活体肾移植术后 12 个月内急性排斥发生率及其危险因素。<br/>
            <b>参与方：</b>单中心移植科，60 例。<br/>
            <b>做法：</b>使用 KTX 模块，记录供体信息、免疫诱导方案、术后随访 Scr/他克莫司谷浓度；系统自动计算 eGFR 趋势。<br/>
            <b>投稿方向：</b>Transplantation / AJT
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-tag general">GENERAL</div>
          <div class="scenario-title">FSGS / ANCA / 糖尿病肾病 / 任意病种真实世界研究</div>
          <div class="small">
            <b>研究目的：</b>例如：评估 FSGS 患者使用 sparsentan 治疗后 UPCR 变化（真实世界观察性研究）。<br/>
            <b>参与方：</b>1–5 家中心，任意规模。<br/>
            <b>做法：</b>选 GENERAL 模块 → 录入任何肾病患者的核心四项（日期/BP/Scr/UPCR）+可选药物/检验 → 导出分析。无需适配特定病种字段。<br/>
            <b>投稿方向：</b>任意肾病/内科期刊
          </div>
        </div>

        <div class="scenario-card">
          <div class="scenario-tag general">多中心</div>
          <div class="scenario-title">多中心 DCC 数据合并示例（任意病种）</div>
          <div class="small">
            <b>场景：</b>4 个中心各自独立录入，DCC（数据协调中心）负责汇总分析。<br/>
            <b>关键：</b>各中心 center_code 不同（BJ01/SH01/GZ01/CD01），patient_code 各自分配；合并时以 center_code+patient_code 作为全局唯一键。<br/>
            <b>操作：</b>各中心后台分别导出论文包 → DCC 将 4 份 CSV 按中心键合并 → 统一运行分析脚本 → 一键生成合并版 Table 1 + QC + 结局。
          </div>
        </div>

      </div>

      <div class="hr"></div>

      <!-- ===== GENERAL 模块详解 ===== -->
      <h2 id="general-module">🔎 什么是 GENERAL（通用 / 混合）模块？</h2>

      <div class="infobox" style="margin-bottom:12px">
        <b>一句话：</b>GENERAL 是"万能接口"——当你的病种不是 IgAN / LN / MN / KTX 时，或你想<b>混合多个病种</b>放进同一个项目，就选 GENERAL。
      </div>

      <div class="guide-grid2">
        <div>
          <b>什么时候选 GENERAL？</b>
          <ul class="compact small" style="margin-top:6px">
            <li>病种为 FSGS、ANCA、IgA 血管炎、糖尿病肾病、高血压肾病、慢性肾脏病（CKD 泛人群）等</li>
            <li>研究对象是"所有肾内科住院患者"（混合病种）</li>
            <li>做<b>跨病种比较</b>（如 IgAN vs. LN 对照组）</li>
            <li>只想快速建一个随访数据库，暂时不确定病种分层</li>
            <li>科室做<b>质量改进（QI）项目</b>，需要跑全科患者数据</li>
          </ul>
        </div>
        <div>
          <b>GENERAL 与其他模块的区别</b>
          <table class="table" style="margin-top:6px">
            <thead><tr><th>模块</th><th>适用场景</th><th>特有字段</th></tr></thead>
            <tbody>
              <tr><td>IgAN</td><td>IgA肾病研究</td><td>Oxford MEST-C 病理积分</td></tr>
              <tr><td>LN</td><td>狼疮性肾炎</td><td>补体/dsDNA</td></tr>
              <tr><td>MN</td><td>膜性肾病</td><td>PLA2R/THSD7A抗体</td></tr>
              <tr><td>KTX</td><td>肾移植随访</td><td>供体/手术/排斥信息</td></tr>
              <tr><td><b>GENERAL</b></td><td><b>任意/混合病种</b></td><td><b>无特有字段，全部通用</b></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="okbox" style="margin-top:10px">
        <b>GENERAL 模块能做什么分析？</b><br/>
        核心四项（日期 / BP / Scr / UPCR）全病种通用 → 可自动计算：<b>eGFR 趋势、UPCR 缓解率、12 个月结局、QC 报告、Table 1 基线特征表、Methods 草稿</b>。<br/>
        如需病种特有指标（如补体、抗体）→ 使用 <code>labs_long</code> 表的自由字段追加即可，分析脚本中可自定义读取。
      </div>

      <details class="faq" style="margin-top:10px">
        <summary>GENERAL 模块举例：全科 CKD 数据库</summary>
        <div class="small">
          <b>场景：</b>某肾内科希望建立科室级别的全患者随访数据库（不区分病种），用于年度质量报告和发表真实世界研究论文。<br/>
          <b>做法：</b>
          <ol>
            <li>后台创建项目，模块选 GENERAL，center_code = 本中心代码</li>
            <li>每位患者录入：研究编号（patient_code）、入组日期、基线 Scr/UPCR/BP</li>
            <li>每次随访录入：日期 + Scr + UPCR + BP</li>
            <li>年底一键导出论文包 → 运行脚本 → 自动生成：平均 eGFR 变化、UPCR 改善率、随访完整率报告</li>
          </ol>
          <b>结果：</b>不用 Excel，不用手写脚本，全科一年数据 1 小时出图出表，直接用于年会汇报和论文。
        </div>
      </details>

      <details class="faq" style="margin-top:8px">
        <summary>GENERAL 模块举例：混合病种研究（IgAN + FSGS 对照）</summary>
        <div class="small">
          <b>场景：</b>研究者想比较 IgAN 与 FSGS 患者对相同治疗方案的反应差异，希望把两组放在同一项目中。<br/>
          <b>做法：</b>选 GENERAL 模块（而不是 IgAN），在 patients_baseline 的 diagnosis 字段分别填 "IgAN" 和 "FSGS" → 分析脚本按 diagnosis 分层即可。<br/>
          <b>优势：</b>同一个项目，同一个 center_code，合并导出时不需要跨项目拼接。
        </div>
      </details>

      <div class="hr"></div>

      <h2 id="roles">你属于哪类角色？（点一下只看你需要的）</h2>
      <div class="rolebar">
        <button class="rolebtn active" data-role="all" type="button">全部内容</button>
        <button class="rolebtn" data-role="entry" type="button">我是录入者（护士/医生/随访）</button>
        <button class="rolebtn" data-role="stats" type="button">我是统计者（研究生/DCC）</button>
        <button class="rolebtn" data-role="pi" type="button">我是 PI/管理员</button>
      </div>

      <section class="role-section" data-role="entry all">
        <div class="hr"></div>
        <h2>录入者：3 分钟上手</h2>
        <div class="guide-grid2">
          <div class="callout">
            <div class="callout-title">你只需要记住两句话</div>
            <ol class="compact">
              <li>每次随访至少录 4 项：<b>日期 / BP / Scr / UPCR</b></li>
              <li><b>不要录入 PII</b>，只用研究编号 <code>patient_code</code></li>
            </ol>
          </div>
          <div class="callout">
            <div class="callout-title">最短步骤</div>
            <ol class="compact">
              <li>打开中心给你的随访链接（token）</li>
              <li>填：日期、血压、Scr、UPCR</li>
              <li>确认无误后提交</li>
            </ol>
          </div>
        </div>

        <details class="faq" style="margin-top:10px">
          <summary>录入常见坑（看一眼就避雷）</summary>
          <ul class="compact small">
            <li>Excel 显示 <code>######</code>：列宽不足，不是坏数据</li>
            <li>Scr/UPCR 数值怪：优先怀疑单位/小数点</li>
            <li>同一天多条随访：尽量避免，会影响趋势/结局计算</li>
          </ul>
        </details>
      </section>

      <section class="role-section" data-role="stats all" id="research">
        <div class="hr"></div>
        <h2>统计者：科研统计 & 论文 Starter Kit（交互教程）</h2>
        <div class="muted">
          目标：让科研小白“点一下按钮就能写论文”。按步骤推进：<b>生成论文包 → 本地运行 → 看 QC → 补数据 → 复现输出</b>。
        </div>

        <div class="stepper" id="stepper">
          <div class="step-nav" role="navigation" aria-label="科研教程步骤">
            <div class="step-nav-title">步骤导航</div>
            <button class="step-item" data-step="0" type="button"><span class="step-idx">0</span> 准备环境</button>
            <button class="step-item" data-step="1" type="button"><span class="step-idx">1</span> 生成论文包</button>
            <button class="step-item" data-step="2" type="button"><span class="step-idx">2</span> 解压与目录核对</button>
            <button class="step-item" data-step="3" type="button"><span class="step-idx">3</span> 安装依赖</button>
            <button class="step-item" data-step="4" type="button"><span class="step-idx">4</span> 一键运行</button>
            <button class="step-item" data-step="5" type="button"><span class="step-idx">5</span> 看 QC 并补数据</button>
            <button class="step-item" data-step="6" type="button"><span class="step-idx">6</span> 放进论文</button>

            <div class="hr" style="margin:12px 0"></div>
            <a class="step-link" href="#faq">常见问题（FAQ）</a>
          </div>

          <div class="step-content">
            <section class="step-panel" data-step-panel="0">
              <div class="step-title">Step 0 · 准备环境（只做一次）</div>
              <p class="small">你只需要一台电脑 + Python 3.10+。科研小白推荐安装 <b>Anaconda</b>。</p>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>检查 Python 是否可用</b></div>
                  <button class="copybtn" type="button" data-copy="python --version&#10;pip --version">复制</button>
                </div>
                <pre><code>python --version
pip --version</code></pre>
              </div>
              <details class="faq">
                <summary>如果提示“python 不是内部命令”，怎么办？</summary>
                <ul class="compact small">
                  <li><b>Windows：</b>重新安装 Python（勾选 Add Python to PATH）或安装 Anaconda。</li>
                  <li><b>Mac：</b>建议安装 python.org 或 Homebrew 版本。</li>
                </ul>
              </details>
              <label class="donecheck"><input type="checkbox" data-done-step="0"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="1">
              <div class="step-title">Step 1 · 在后台一键生成论文包（zip）</div>
              <p class="small">
                后台 <code>/staff</code> 打开项目后点击：<b>「一键生成论文包（zip）」</b>。
                系统会打包：去标识化 CSV 长表 + Starter Kit（脚本与模板）。
              </p>
              <label class="donecheck"><input type="checkbox" data-done-step="1"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="2">
              <div class="step-title">Step 2 · 解压与目录核对</div>
              <p class="small">解压 zip 后，确认包含 <code>analysis/data/</code> 与 <code>analysis/run_analysis.py</code>。</p>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>目录应类似这样</b></div>
                  <button class="copybtn" type="button" data-copy="paper_pack_xxx/&#10;  analysis/&#10;    data/&#10;      patients_baseline.csv&#10;      visits_long.csv&#10;      labs_long.csv&#10;      meds_long.csv&#10;      variants_long.csv&#10;    run_analysis.py&#10;    outputs/&#10;  manuscript/&#10;    METHODS_AUTO_EN.md">复制</button>
                </div>
                <pre><code>paper_pack_xxx/
  analysis/
    data/
      patients_baseline.csv
      visits_long.csv
      labs_long.csv
      meds_long.csv
      variants_long.csv
    run_analysis.py
    outputs/
  manuscript/
    METHODS_AUTO_EN.md</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="2"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="3">
              <div class="step-title">Step 3 · 安装依赖（第一次才需要）</div>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>安装依赖</b></div>
                  <button class="copybtn" type="button" data-copy="pip install -r analysis/requirements.txt">复制</button>
                </div>
                <pre><code>pip install -r analysis/requirements.txt</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="3"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="4">
              <div class="step-title">Step 4 · 一键运行（生成 Table1/QC/图/12m结局/Methods）</div>
              <div class="codebox">
                <div class="codebox-head">
                  <div><b>运行脚本</b></div>
                  <button class="copybtn" type="button" data-copy="python analysis/run_analysis.py">复制</button>
                </div>
                <pre><code>python analysis/run_analysis.py</code></pre>
              </div>
              <label class="donecheck"><input type="checkbox" data-done-step="4"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="5">
              <div class="step-title">Step 5 · 先看 QC，再补数据，再跑一遍</div>
              <p class="small">
                顶刊级研究最重要的是：数据干净、口径统一、可复现。请优先打开 <code>analysis/outputs/qc_report.xlsx</code>。
              </p>
              <label class="donecheck"><input type="checkbox" data-done-step="5"> 我已完成此步</label>
            </section>

            <section class="step-panel" data-step-panel="6">
              <div class="step-title">Step 6 · 把输出放进论文</div>
              <table class="table">
                <thead><tr><th>输出</th><th>用于论文</th><th>备注</th></tr></thead>
                <tbody>
                  <tr><td><code>table1_baseline.xlsx</code></td><td>Table 1</td><td>基线特征表</td></tr>
                  <tr><td><code>qc_report.xlsx</code></td><td>质量控制</td><td>缺失/异常/重复/中心汇总</td></tr>
                  <tr><td><code>plot_*.png</code></td><td>Figure</td><td>趋势图</td></tr>
                  <tr><td><code>outcomes_12m.csv</code></td><td>Results</td><td>12 个月结局</td></tr>
                  <tr><td><code>METHODS_AUTO_EN.md</code></td><td>Methods 草稿</td><td>PI 最终审阅</td></tr>
                </tbody>
              </table>
              <label class="donecheck"><input type="checkbox" data-done-step="6"> 我已完成此步</label>
            </section>
          </div>
        </div>
      </section>

      <section class="role-section" data-role="pi all">
        <div class="hr"></div>
        <h2>PI/管理员：多中心治理要点（务实）</h2>
        <div class="kv">
          <div>合并键</div><div><b>center_code + patient_code</b>（必须全局唯一）</div>
          <div>去标识化</div><div>系统不存身份信息；各中心本地受控保存映射表</div>
          <div>口径统一</div><div>最少四项（日期/BP/Scr/UPCR）+ 单位一致性</div>
          <div>试用到期</div><div>到期后只读，避免边分析边改数据，保证可复现</div>
          <div>IgAN 病理</div><div>支持 Oxford <b>MEST‑C</b>（常用于分层/预测/敏感性分析）</div>
          <div>基因</div><div>支持 variants_long（如有：ACMG、zygosity、HGVS 等）</div>
        </div>
      </section>

      <div class="hr"></div>

      <h2 id="faq">常见问题（FAQ）</h2>
      <div class="faq-tools">
        <input id="faqSearch" placeholder="搜索：乱码 / ###### / ModuleNotFoundError / token / MEST / 基因 …"/>
        <button class="btn small" id="faqOpenAll" type="button">全部展开</button>
        <button class="btn small" id="faqCloseAll" type="button">全部收起</button>
      </div>

      <details class="faq" open data-faq>
        <summary>Excel 打开 CSV 显示乱码怎么办？</summary>
        <div class="small">
          建议使用 Excel「数据 → 从文本/CSV」导入并选择编码 UTF‑8。系统导出的 CSV 已带 UTF‑8 BOM，直接打开通常不会乱码。
        </div>
      </details>

      <details class="faq" data-faq>
        <summary>Excel 里日期显示 ###### 是数据坏了吗？</summary>
        <div class="small">不是。通常是列宽不足。双击列边界自动适配即可显示日期。</div>
      </details>

      <details class="faq" data-faq>
        <summary>脚本运行报错：ModuleNotFoundError</summary>
        <div class="small">说明依赖没装好。执行：<code>pip install -r analysis/requirements.txt</code>。</div>
      </details>

      <details class="faq" data-faq>
        <summary>同一患者同一天多条随访怎么办？</summary>
        <div class="small">通常视为重复记录。建议保留一条（或合并），否则趋势/结局会受影响。</div>
      </details>

      <details class="faq" data-faq>
        <summary>为什么强调不录入 PII？</summary>
        <div class="small">为了合规与多中心协作。系统用研究编号即可完成随访与分析；身份映射表由各中心本地受控保存。</div>
      </details>


      <details class="faq" data-faq>
        <summary>这套系统可以直接用于药厂 1/2/3 期注册临床试验吗？</summary>
        <div class="small">
          <b>不建议直接作为注册试验主系统（eCRF/EDC）</b>。当前系统定位是科研随访与论文产出加速工具，适合观察性研究、真实世界研究（RWS）或研究者发起课题（IIT）的数据整理与分析。<br/>
          若用于药厂 I/II/III 期注册路径，通常还需满足 GCP 稽查追踪、21 CFR Part 11 / 电子签名、完整审计追踪、受控变更、冻结锁库、角色分离、医学编码（MedDRA/WHODrug）、SDTM/ADaM 规范输出等要求。
        </div>
      </details>

      <div class="hr"></div>

      <div class="muted small">
        最后更新：2026-02-20。可直接分享链接作为中心培训：<code>/guide#trial</code> 或 <code>/guide#research</code>。
      </div>
    </div>
  </div>

  <script type="module" src="/guide.js"></script>
</body>
</html>
